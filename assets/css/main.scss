/* ========================================================================
   JAPANESE DESIGN SYSTEM - PERFORMANCE OPTIMIZED
   ======================================================================== */

/* =============================================================================
   PART 1: STRATEGIC FONT LOADING - 字體策略優化
   ============================================================================= */

/* 1. 核心字體 - 只載入必要字重 */
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Shippori+Mincho+B1:wght@400;500;600;700&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&display=swap');

/* 2. 英文裝飾字體 - 精選載入 */
@import url('https://fonts.googleapis.com/css2?family=Marcellus:wght@400;700&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Tenor+Sans:wght@400;600&display=swap');
@import url('https://fonts.googleapis.com/css2?family=DM+Serif+Text:ital,wght@0,400;1,400&display=swap');

/* 3. 程式碼字體 */
@import url('https://fonts.googleapis.com/css2?family=Fira+Mono:wght@400;500&display=swap');

/* 4. 傳統中文字體 - 延遲載入 */
@import url('https://fonts.googleapis.com/css2?family=Noto+Serif+Traditional+Chinese:wght@400;500;600&display=swap');

/* Minimal Mistakes 整合 */
@import "minimal-mistakes/skins/{{ site.minimal_mistakes_skin | default: 'default' }}";
@import "minimal-mistakes";

/* =============================================================================
   PART 2: 日本色彩系統 - 完整語意化設計
   ============================================================================= */

:root {
  /* 字體層級系統 - 保持你的原始概念但結構化 */
  --font-primary-tc: 'Noto Sans TC', 'PingFang TC', 'Microsoft JhengHei', sans-serif;
  --font-secondary-tc: 'Shippori Mincho B1', 'Noto Serif Traditional Chinese', serif;
  --font-interface: 'Zen Maru Gothic', system-ui, sans-serif;
  
  /* 英文字體 - 維持你的典雅風格 */
  --font-title-en: 'Marcellus', 'Times New Roman', serif;
  --font-body-en: 'Tenor Sans', 'Helvetica Neue', sans-serif;
  --font-quote-en: 'DM Serif Text', Georgia, serif;
  --font-code: 'Fira Mono', 'SF Mono', Consolas, monospace;
  
  /* 閱讀字體切換系統 - 保持你的概念 */
  --reading-font-serif: var(--font-secondary-tc);
  --reading-font-sans: var(--font-primary-tc);
  --reading-font-main: var(--reading-font-serif); /* 預設使用襯線體 */

  /* 日本傳統色彩 - 維持你的美學但增強對比度 */
  /* 日間模式 (溫柔日本色票) */
  --sakura: #ffadd6;           /* 櫻花色 - 主色調 */
  --toki: #f5b2b2;            /* 鴇色 - 次要色 */
  --yamabuki: #f8b500;         /* 山吹色 - 強調色 */
  --nando: #2f5d62;           /* 納戸色 - 主文字 */
  --ainezumi: #566c73;         /* 藍鼠 - 次要文字 */
  --ruri: #1e50a2;            /* 瑠璃色 - 連結 */
  --sango: #f17c67;           /* 珊瑚色 - 懸停 */
  --wakatake: #68be8d;         /* 若竹色 - 成功 */
  --moegi: #93b881;           /* 萌黄 - 按鈕懸停 */
  --matcha: #c5c56a;          /* 抹茶色 - 標籤 */
  
  /* 中性色彩 - 增強可用性 */
  --shiro: #ffffff;           /* 白 - 背景 */
  --usuzumi: #f8fafb;         /* 薄墨 - 次要背景 */
  --ginmouse: #e8f4f8;        /* 銀鼠 - 淡背景 */
  --mizuiro: #b8d4e3;         /* 水色 - 邊框 */

  /* 夜間模式 (深邃夜色) */
  --yoru-murasaki: #4a4458;    /* 夜紫 - 主色調 */
  --kon: #5c4a72;             /* 紺 - 次要色 */
  --kogane: #d4af37;          /* 黃金 - 強調色 */
  --zoge: #e8e3d3;            /* 象牙 - 主文字 */
  --haizakura: #c8c3b8;       /* 灰櫻 - 次要文字 */
  --asagi: #9bb8d3;           /* 淺蔥 - 連結 */
  --beni: #e8a87c;            /* 紅 - 懸停 */
  --kuro: #1a1a1a;            /* 黑 - 背景 */
  --sumizumi: #2d2d2d;        /* 炭 - 次要背景 */
  --hai: #262626;             /* 灰 - 淡背景 */
  --tetsu: #404040;           /* 鐵 - 邊框 */

  /* 語意化色彩映射 - 日間模式 */
  --color-primary: var(--sakura);
  --color-secondary: var(--toki);
  --color-accent: var(--yamabuki);
  --color-text: var(--nando);
  --color-text-muted: var(--ainezumi);
  --color-link: var(--ruri);
  --color-link-hover: var(--sango);
  --color-success: var(--wakatake);
  --color-warning: var(--yamabuki);
  --color-tag: var(--matcha);
  
  /* 背景色系統 */
  --color-bg: var(--shiro);
  --color-bg-elevated: var(--usuzumi);
  --color-bg-muted: var(--ginmouse);
  --color-border: var(--mizuiro);
  --color-surface: var(--color-bg);
  
  /* 程式碼色彩 - 日間 */
  --color-code-bg: #f8f9fa;
  --color-code-text: #2d3748;
  --color-code-border: #e2e8f0;
  --color-inline-code-bg: #edf2f7;
  --color-inline-code-text: #c53030;
  
  /* 間距系統 - 8px 基準 */
  --space-xs: 0.25rem;    /* 4px */
  --space-sm: 0.5rem;     /* 8px */
  --space-md: 1rem;       /* 16px */
  --space-lg: 1.5rem;     /* 24px */
  --space-xl: 2rem;       /* 32px */
  --space-2xl: 3rem;      /* 48px */
  
  /* 圓角系統 */
  --radius-sm: 0.25rem;   /* 4px */
  --radius-md: 0.5rem;    /* 8px */
  --radius-lg: 0.75rem;   /* 12px */
  --radius-xl: 1rem;      /* 16px */
  --radius-pill: 50px;
  
  /* 陰影系統 */
  --shadow-subtle: 0 1px 3px rgba(0, 0, 0, 0.05);
  --shadow-soft: 0 2px 8px rgba(0, 0, 0, 0.08);
  --shadow-medium: 0 4px 15px rgba(0, 0, 0, 0.12);
  --shadow-strong: 0 8px 32px rgba(0, 0, 0, 0.15);
  
  /* 動畫時間 */
  --duration-fast: 150ms;
  --duration-normal: 250ms;
  --duration-slow: 350ms;
}

/* 夜間模式切換 */
[data-theme="dark"] {
  --color-primary: var(--yoru-murasaki);
  --color-secondary: var(--kon);
  --color-accent: var(--kogane);
  --color-text: var(--zoge);
  --color-text-muted: var(--haizakura);
  --color-link: var(--asagi);
  --color-link-hover: var(--beni);
  --color-success: #6b8e7f;
  --color-warning: var(--kogane);
  --color-tag: #8b956d;
  
  --color-bg: var(--kuro);
  --color-bg-elevated: var(--sumizumi);
  --color-bg-muted: var(--hai);
  --color-border: var(--tetsu);
  --color-surface: var(--sumizumi);
  
  /* 程式碼色彩 - 夜間 */
  --color-code-bg: #1a202c;
  --color-code-text: #e2e8f0;
  --color-code-border: #2d3748;
  --color-inline-code-bg: #2d3748;
  --color-inline-code-text: #fc8181;
  
  color-scheme: dark;
}

/* =============================================================================
   PART 3: 基礎設定 - 效能與可訪問性優先
   ============================================================================= */

/* 現代 CSS Reset */
*,
*::before,
*::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

/* 尊重使用者的動作偏好 */
@media (prefers-reduced-motion: no-preference) {
  html {
    scroll-behavior: smooth;
  }
  
  * {
    transition: 
      background-color var(--duration-normal) ease,
      color var(--duration-normal) ease,
      border-color var(--duration-normal) ease,
      box-shadow var(--duration-normal) ease,
      transform var(--duration-fast) ease;
  }
}

@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

html {
  font-size: 100%;
  text-size-adjust: 100%;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* =============================================================================
   PART 4: 主體字體設定 - 保持你的風格理念
   ============================================================================= */

body {
  font-family: var(--font-body-en), var(--reading-font-main);
  font-size: 1rem;
  font-weight: 400;
  line-height: 1.7; /* 稍微放鬆行距 */
  letter-spacing: 0.02em;
  background-color: var(--color-bg);
  color: var(--color-text);
  font-feature-settings: "kern" 1, "liga" 1;
}

/* =============================================================================
   PART 5: 標題層級 - 維持你的粗體+緊密理念但改善可讀性
   ============================================================================= */

h1, h2, h3, h4, h5, h6,
.page__title, 
.page__hero-title, 
.site-title {
  font-family: var(--font-title-en), var(--font-interface), var(--font-secondary-tc);
  color: var(--color-text);
  font-weight: 700;
  letter-spacing: -0.02em;
  line-height: 1.2;
  margin-top: 0;
  margin-bottom: var(--space-md);
}

h1 { 
  font-size: 2.25rem; /* 36px - 更大標題 */
  font-weight: 800;
  letter-spacing: -0.03em;
  margin-bottom: var(--space-lg);
}

h2 { 
  font-size: 1.875rem; /* 30px */
  font-weight: 700;
  letter-spacing: -0.02em;
  margin-top: var(--space-xl);
  margin-bottom: var(--space-md);
}

h3 { 
  font-size: 1.5rem; /* 24px */
  font-weight: 600;
  letter-spacing: -0.01em;
  margin-top: var(--space-lg);
}

h4 { 
  font-size: 1.25rem; /* 20px */
  font-weight: 600;
}

h5 { 
  font-size: 1.125rem; /* 18px */
  font-weight: 500;
}

h6 { 
  font-size: 1rem; /* 16px */
  font-weight: 500;
}

/* =============================================================================
   PART 6: 日夜切換按鈕 - 保持你的設計但增強互動
   ============================================================================= */

.theme-toggle {
  position: fixed;
  top: var(--space-lg);
  right: var(--space-lg);
  z-index: 1000;
  background: var(--color-surface);
  border: 2px solid var(--color-border);
  border-radius: var(--radius-pill);
  padding: var(--space-sm) var(--space-md);
  cursor: pointer;
  font-family: var(--font-interface);
  font-size: 0.875rem;
  font-weight: 500;
  color: var(--color-text);
  box-shadow: var(--shadow-medium);
  backdrop-filter: blur(10px);
  transition: all var(--duration-normal) ease;
  display: flex;
  align-items: center;
  gap: var(--space-sm);
}

.theme-toggle:hover {
  transform: scale(1.05);
  box-shadow: var(--shadow-strong);
  border-color: var(--color-accent);
}

.theme-toggle::before {
  content: "🌸";
  font-size: 1rem;
}

[data-theme="dark"] .theme-toggle::before {
  content: "🌙";
}

/* =============================================================================
   PART 7: 導航系統 - 保持漸層美學但增強可用性
   ============================================================================= */

.masthead {
  background: linear-gradient(135deg, 
    var(--color-primary) 0%, 
    var(--color-secondary) 50%, 
    var(--color-bg-elevated) 100%);
  border-bottom: 1px solid var(--color-border);
  box-shadow: var(--shadow-soft);
  position: sticky;
  top: 0;
  z-index: 999;
  backdrop-filter: blur(10px);
}

.site-title {
  font-family: var(--font-title-en);
  font-weight: 700;
  font-size: 1.5rem;
  color: var(--color-text);
  text-decoration: none;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  letter-spacing: -0.01em;
  transition: all var(--duration-normal) ease;
}

.site-title:hover {
  transform: scale(1.02);
  text-shadow: 2px 2px 8px hsla(from var(--color-primary) h s l / 0.4);
  color: var(--color-text);
}

.greedy-nav a {
  color: var(--color-text);
  font-size: 0.9rem;
  font-family: var(--font-interface);
  font-weight: 500;
  letter-spacing: -0.005em;
  padding: var(--space-sm) var(--space-md);
  border-radius: var(--radius-md);
  transition: all var(--duration-fast) ease;
}

.greedy-nav a:hover {
  color: var(--color-link);
  background-color: hsla(from var(--color-bg-muted) h s l / 0.8);
}

/* =============================================================================
   PART 8: 頁面標題 - 保持中央對齊和裝飾但改善層級
   ============================================================================= */

.page__title {
  font-family: var(--font-title-en);
  font-size: 2rem;
  font-weight: 700;
  color: var(--color-text);
  text-align: center;
  position: relative;
  padding-bottom: var(--space-md);
  margin-bottom: var(--space-xl);
  border-bottom: 3px solid var(--color-accent);
  letter-spacing: -0.02em;
  line-height: 1.1;
}

/* 可選的裝飾元素 - 保持你的美學概念 */
.page__title--decorated::before,
.page__title--decorated::after {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  font-size: 1.2rem;
  opacity: 0.7;
}

.page__title--decorated::before {
  content: "🌸";
  left: -3rem;
}

.page__title--decorated::after {
  content: "🌸";
  right: -3rem;
}

[data-theme="dark"] .page__title--decorated::before,
[data-theme="dark"] .page__title--decorated::after {
  content: "🌙";
}

/* =============================================================================
   PART 9: 連結系統 - 精緻的懸停效果
   ============================================================================= */

a {
  color: var(--color-link);
  text-decoration: none;
  text-decoration-color: transparent;
  text-decoration-thickness: 2px;
  text-underline-offset: 2px;
  transition: all var(--duration-fast) ease;
}

a:hover {
  color: var(--color-link-hover);
  text-decoration-color: currentColor;
}

a:focus-visible {
  outline: 2px solid var(--color-accent);
  outline-offset: 2px;
  border-radius: var(--radius-sm);
}

/* =============================================================================
   PART 10: 按鈕系統 - 保持漸層美學
   ============================================================================= */

.btn {
  background: linear-gradient(135deg, 
    var(--color-success) 0%, 
    var(--color-primary) 100%);
  color: var(--color-bg);
  border: none;
  border-radius: var(--radius-pill);
  padding: var(--space-sm) var(--space-lg);
  font-family: var(--font-interface);
  font-weight: 600;
  font-size: 0.875rem;
  letter-spacing: 0.05em;
  text-transform: uppercase;
  box-shadow: var(--shadow-medium);
  cursor: pointer;
  transition: all var(--duration-normal) ease;
}

.btn:hover {
  color: var(--color-bg);
  transform: translateY(-2px);
  box-shadow: var(--shadow-strong);
}

.btn:focus-visible {
  outline: 2px solid var(--color-accent);
  outline-offset: 2px;
}

/* =============================================================================
   PART 11: 文章卡片 - 保持緊密布局但改善間距
   ============================================================================= */

.archive__item {
  background: var(--color-surface);
  border-left: 6px solid var(--color-tag);
  border-radius: var(--radius-lg);
  padding: var(--space-md) var(--space-lg);
  margin-bottom: var(--space-md);
  box-shadow: var(--shadow-soft);
  position: relative;
  overflow: hidden;
  transition: all var(--duration-normal) ease;
}

.archive__item:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-medium);
  border-left-color: var(--color-accent);
}

.archive__item-title {
  margin-bottom: var(--space-sm);
  line-height: 1.3;
}

.archive__item-title a {
  font-family: var(--font-interface);
  font-size: 1.125rem;
  font-weight: 600;
  line-height: 1.3;
  color: var(--color-text);
}

.archive__item-excerpt {
  margin-bottom: var(--space-sm);
  font-size: 0.875rem;
  line-height: 1.6;
  color: var(--color-text-muted);
}

.archive__item .page__meta {
  margin-bottom: 0;
  font-size: 0.75rem;
  color: var(--color-text-muted);
  font-family: var(--font-interface);
}

/* =============================================================================
   PART 12: 側邊欄 - 保持漸層背景和固定定位
   ============================================================================= */

.sidebar {
  background: linear-gradient(135deg, 
    var(--color-bg-elevated) 0%, 
    hsla(from var(--color-border) h s l / 0.3) 100%);
  padding: var(--space-lg);
  border-radius: var(--radius-xl);
  border: 1px solid var(--color-border);
  backdrop-filter: blur(10px);
  position: sticky;
  top: var(--space-lg);
  max-height: calc(100vh - var(--space-2xl));
  overflow-y: auto;
  box-shadow: var(--shadow-medium);
  scrollbar-width: thin;
  scrollbar-color: var(--color-border) transparent;
}

.sidebar::-webkit-scrollbar {
  width: 4px;
}

.sidebar::-webkit-scrollbar-track {
  background: transparent;
}

.sidebar::-webkit-scrollbar-thumb {
  background: var(--color-border);
  border-radius: var(--radius-sm);
}

.author__avatar {
  margin-bottom: var(--space-md);
}

.author__avatar img {
  border: 4px solid var(--color-accent);
  box-shadow: var(--shadow-medium);
  border-radius: 50%;
}

.author__bio {
  margin-bottom: var(--space-md);
  font-size: 0.875rem;
  line-height: 1.6;
  color: var(--color-text-muted);
}

.author__urls {
  margin-bottom: var(--space-md);
}

.author__urls li {
  margin-bottom: var(--space-xs);
}

/* =============================================================================
   PART 13: 標籤系統 - 保持漸層和大寫風格
   ============================================================================= */

.page__taxonomy-item {
  background: linear-gradient(135deg, 
    var(--color-tag) 0%, 
    var(--color-accent) 100%);
  color: var(--color-bg);
  border-radius: var(--radius-pill);
  padding: var(--space-xs) var(--space-md);
  font-family: var(--font-interface);
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  box-shadow: var(--shadow-soft);
  transition: all var(--duration-normal) ease;
  display: inline-block;
  margin: var(--space-xs);
}

.page__taxonomy-item:hover {
  background: linear-gradient(135deg, 
    var(--color-success) 0%, 
    var(--color-primary) 100%);
  transform: scale(1.05);
  box-shadow: var(--shadow-medium);
  color: var(--color-bg);
}

/* =============================================================================
   PART 14: 引用文字 - 保持詩意風格但改善可讀性
   ============================================================================= */

blockquote {
  border-left: 4px solid var(--color-link-hover);
  background: linear-gradient(135deg, 
    var(--color-bg-elevated), 
    hsla(from var(--color-border) h s l / 0.3));
  color: var(--color-text);
  padding: var(--space-md) var(--space-lg);
  margin: var(--space-lg) 0;
  border-radius: 0 var(--radius-lg) var(--radius-lg) 0;
  font-family: var(--font-quote-en), var(--reading-font-main);
  font-size: 0.95rem;
  line-height: 1.6;
  font-style: italic;
  font-weight: 400;
  position: relative;
  box-shadow: var(--shadow-soft);
}

blockquote::before {
  content: "💭";
  position: absolute;
  left: -15px;
  top: -10px;
  font-size: 1rem;
  background: var(--color-bg);
  padding: var(--space-xs);
  border-radius: 50%;
  box-shadow: var(--shadow-soft);
}

[data-theme="dark"] blockquote::before {
  content: "🌌";
  background: var(--color-bg);
}

/* =============================================================================
   PART 15: 程式碼區塊 - 確保兩種主題下的可見性
   ============================================================================= */

.highlight,
pre {
  background: var(--color-code-bg);
  border: 1px solid var(--color-code-border);
  border-left: 6px solid var(--color-link);
  border-radius: var(--radius-md);
  padding: var(--space-md);
  margin: var(--space-lg) 0;
  box-shadow: var(--shadow-soft);
  overflow-x: auto;
  position: relative;
}

.highlight code,
pre code {
  font-family: var(--font-code);
  font-size: 0.875rem;
  line-height: 1.6;
  color: var(--color-code-text);
  background: transparent;
  padding: 0;
  border-radius: 0;
  display: block;
  white-space: pre;
  word-wrap: normal;
}

/* 行內程式碼 */
code {
  font-family: var(--font-code);
  font-size: 0.875rem;
  background: var(--color-inline-code-bg);
  color: var(--color-inline-code-text);
  padding: var(--space-xs) var(--space-sm);
  border-radius: var(--radius-sm);
  border: 1px solid var(--color-border);
  font-weight: 500;
}

/* 確保程式碼區塊內的 code 不被行內樣式影響 */
.highlight code,
pre code {
  background: transparent;
  border: none;
  color: var(--color-code-text);
  padding: 0;
}

/* 程式碼區塊滾動條 */
.highlight::-webkit-scrollbar {
  height: 8px;
}

.highlight::-webkit-scrollbar-track {
  background: var(--color-bg-muted);
  border-radius: var(--radius-sm);
}

.highlight::-webkit-scrollbar-thumb {
  background: var(--color-border);
  border-radius: var(--radius-sm);
}

.highlight::-webkit-scrollbar-thumb:hover {
  background: var(--color-text-muted);
}

/* =============================================================================
   PART 16: 文章內容區域 - 保持緊密但可讀的布局
   ============================================================================= */

.page__content {
  background: var(--color-bg);
  color: var(--color-text);
  padding: var(--space-xl) var(--space-2xl);
  border-radius: var(--radius-lg);
  font-family: var(--font-body-en), var(--reading-font-main);
  font-size: 1rem;
  line-height: 1.7;
  max-width: none;
}

/* 為右側目錄留出空間 - 保持你的布局概念 */
@media (min-width: 1024px) {
  .page__content {
    margin-right: 320px; /* 為TOC預留空間 */
  }
}

/* 段落樣式 - 保持你的緊密間距理念但稍微調整 */
.page__content p {
  margin-bottom: 1.2em; /* 稍微增加段落間距 */
  text-align: justify;
  color: var(--color-text);
  max-width: 65ch; /* 最佳閱讀寬度 */
}

/* 標題間距調整 - 保持層級感 */
.page__content h1,
.page__content h2,
.page__content h3,
.page__content h4,
.page__content h5,
.page__content h6 {
  margin-top: 1.5em;
  margin-bottom: 0.8em;
  color: var(--color-text);
}

.page__content h2 {
  margin-top: 2em; /* h2 需要更多上方空間 */
}

/* 列表樣式 - 改善可讀性 */
.page__content ul,
.page__content ol {
  margin-bottom: 1em;
  padding-left: 1.5em;
}

.page__content li {
  margin-bottom: 0.25em;
  line-height: 1.6;
}

/* 首字放大效果 - 保持你的典雅風格 */
.page__content > p:first-of-type::first-letter {
  font-size: 3em;
  font-family: var(--font-title-en);
  font-weight: 400;
  float: left;
  line-height: 0.8;
  margin: 0.1em 0.15em 0 0;
  color: var(--color-accent);
  text-shadow: 2px 2px 4px hsla(from var(--color-accent) h s l / 0.3);
}

/* =============================================================================
   PART 17: 右側目錄 - 保持固定定位和優雅樣式
   ============================================================================= */

.toc {
  position: fixed;
  right: var(--space-lg);
  top: 120px;
  width: 240px;
  max-height: calc(100vh - 150px);
  overflow-y: auto;
  z-index: 999;
  background: var(--color-surface);
  backdrop-filter: blur(10px);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow-strong);
  scrollbar-width: thin;
  scrollbar-color: var(--color-border) transparent;
}

.toc::-webkit-scrollbar {
  width: 4px;
}

.toc::-webkit-scrollbar-track {
  background: transparent;
}

.toc::-webkit-scrollbar-thumb {
  background: var(--color-border);
  border-radius: var(--radius-sm);
}

.toc::-webkit-scrollbar-thumb:hover {
  background: var(--color-tag);
}

/* 目錄標題 - 保持你的設計理念 */
.toc .nav__title {
  background: var(--color-tag);
  color: var(--color-text);
  font-family: var(--font-interface);
  font-weight: 600;
  font-size: 0.875rem;
  padding: var(--space-md);
  margin: 0;
  border-radius: var(--radius-xl) var(--radius-xl) 0 0;
  text-align: center;
  letter-spacing: 0.02em;
}

/* 可選的圖標 - 保持你的裝飾理念 */
.toc .nav__title--with-icon::before {
  content: "📖 ";
  margin-right: var(--space-xs);
}

/* 目錄列表樣式 */
.toc nav ul {
  margin: 0;
  padding: var(--space-md);
  list-style: none;
}

.toc nav li {
  margin-bottom: var(--space-sm);
  line-height: 1.2;
}

.toc nav a {
  color: var(--color-text);
  text-decoration: none;
  font-size: 0.8rem; /* 稍微大一點提高可讀性 */
  font-family: var(--font-body-en), var(--reading-font-sans);
  font-weight: 400;
  padding: var(--space-xs) var(--space-sm);
  border-radius: var(--radius-sm);
  display: block;
  transition: all var(--duration-fast) ease;
  border-left: 3px solid transparent;
}

.toc nav a:hover {
  background: var(--color-bg-muted);
  color: var(--color-link);
  border-left-color: var(--color-accent);
  transform: translateX(3px);
}

/* 目錄層級縮排 - 保持你的層級系統 */
.toc nav ul ul {
  padding-left: var(--space-lg);
}

.toc nav ul ul a {
  font-size: 0.75rem;
  color: var(--color-text-muted);
}

.toc nav ul ul ul {
  padding-left: var(--space-xl);
}

.toc nav ul ul ul a {
  font-size: 0.7rem;
  opacity: 0.8;
}

/* 當前閱讀位置高亮 */
.toc nav a.active {
  background: var(--color-accent);
  color: var(--color-bg);
  border-left-color: var(--color-link);
  font-weight: 600;
}

/* 移除側邊欄中的目錄以避免重複 */
.sidebar .toc {
  display: none;
}

/* 目錄切換按鈕 - 保持你的圓形設計 */
.toc-toggle {
  position: fixed;
  right: var(--space-lg);
  top: 80px;
  z-index: 1001;
  background: var(--color-surface);
  border: 2px solid var(--color-border);
  border-radius: 50%;
  width: 44px;
  height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 1.1rem;
  box-shadow: var(--shadow-medium);
  backdrop-filter: blur(10px);
  transition: all var(--duration-normal) ease;
}

.toc-toggle::before {
  content: "📋";
}

[data-theme="dark"] .toc-toggle::before {
  content: "📄";
}

.toc-toggle:hover {
  transform: scale(1.1);
  box-shadow: var(--shadow-strong);
  border-color: var(--color-accent);
}

/* 目錄隱藏狀態 */
.toc.hidden {
  transform: translateX(100%);
  opacity: 0;
  pointer-events: none;
}

/* =============================================================================
   PART 18: 輸入框系統 - 保持一致的設計語言
   ============================================================================= */

input[type="search"], 
input[type="text"], 
input[type="email"] {
  background: var(--color-bg);
  border: 2px solid var(--color-border);
  color: var(--color-text);
  border-radius: var(--radius-md);
  padding: var(--space-sm) var(--space-md);
  font-family: var(--font-interface);
  font-size: 0.875rem;
  transition: all var(--duration-fast) ease;
}

input[type="search"]:focus, 
input[type="text"]:focus, 
input[type="email"]:focus {
  border-color: var(--color-link);
  outline: none;
  box-shadow: 0 0 0 3px hsla(from var(--color-link) h s l / 0.1);
}

/* =============================================================================
   PART 19: 頁腳 - 保持漸層設計
   ============================================================================= */

.page__footer {
  background: linear-gradient(135deg, 
    var(--color-text-muted) 0%, 
    var(--color-text) 100%);
  color: var(--color-bg);
  margin-top: var(--space-2xl);
  padding: var(--space-2xl) 0;
}

.page__footer a {
  color: var(--color-bg-elevated);
  transition: color var(--duration-fast) ease;
}

.page__footer a:hover {
  color: var(--color-bg);
}

/* =============================================================================
   PART 20: 響應式設計 - 保持你的斷點邏輯
   ============================================================================= */

/* 平板佈局 */
@media (max-width: 1200px) {
  .toc {
    width: 220px;
  }
  
  .page__content {
    margin-right: 250px;
  }
  
  .theme-toggle {
    top: var(--space-md);
    right: var(--space-md);
  }
}

/* 手機佈局 */
@media (max-width: 768px) {
  :root {
    --space-md: 0.75rem;
    --space-lg: 1rem;
    --space-xl: 1.25rem;
    --space-2xl: 1.5rem;
  }

  .toc,
  .toc-toggle {
    display: none;
  }
  
  .page__content {
    margin-right: 0;
    padding: var(--space-md);
  }
  
  .theme-toggle {
    top: var(--space-sm);
    right: var(--space-sm);
    padding: var(--space-xs) var(--space-sm);
    font-size: 0.75rem;
  }
  
  .masthead {
    padding: var(--space-sm) 0;
  }
  
  h1 {
    font-size: 1.75rem;
  }
  
  h2 {
    font-size: 1.5rem;
  }
  
  .page__title {
    font-size: 1.75rem;
    margin-bottom: var(--space-lg);
  }
  
  .archive__item {
    padding: var(--space-md);
  }
  
  .sidebar {
    padding: var(--space-md);
  }
  
  /* 移除首字放大效果在小螢幕上 */
  .page__content > p:first-of-type::first-letter {
    font-size: inherit;
    float: none;
    margin: 0;
    color: inherit;
    text-shadow: none;
  }
}

/* 小手機佈局 */
@media (max-width: 480px) {
  .page__content {
    padding: var(--space-sm);
  }
  
  .archive__item {
    padding: var(--space-sm) var(--space-md);
  }
  
  .sidebar {
    padding: var(--space-sm);
  }
  
  .theme-toggle {
    padding: var(--space-xs);
    font-size: 0.7rem;
  }
  
  h1 {
    font-size: 1.5rem;
  }
  
  .page__title {
    font-size: 1.5rem;
  }
  
  /* 移除裝飾元素在極小螢幕 */
  .page__title--decorated::before,
  .page__title--decorated::after {
    display: none;
  }
}

/* =============================================================================
   PART 21: 可訪問性增強 - 尊重使用者偏好
   ============================================================================= */

/* 高對比模式支援 */
@media (prefers-contrast: high) {
  :root {
    --color-border: var(--color-text);
    --color-bg-muted: var(--color-bg);
  }
  
  [data-theme="dark"] {
    --color-border: var(--color-text);
    --color-bg-muted: var(--color-bg);
  }
  
  .btn,
  .page__taxonomy-item {
    border: 2px solid currentColor;
  }
  
  .archive__item {
    border: 1px solid var(--color-border);
  }
}

/* 螢幕閱讀器專用內容 */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* 跳躍連結 */
.skip-link {
  position: absolute;
  top: -40px;
  left: var(--space-sm);
  background: var(--color-text);
  color: var(--color-bg);
  padding: var(--space-sm) var(--space-md);
  text-decoration: none;
  border-radius: var(--radius-md);
  z-index: 1100;
  font-weight: 600;
  transition: top var(--duration-fast) ease;
}

.skip-link:focus {
  top: var(--space-sm);
}

/* 焦點指示器 */
.focus-ring:focus-visible {
  outline: 2px solid var(--color-accent);
  outline-offset: 2px;
  border-radius: var(--radius-sm);
}

/* =============================================================================
   PART 22: 效能優化 - 現代 CSS 技術
   ============================================================================= */

/* GPU 加速關鍵元素 */
.theme-toggle,
.btn,
.archive__item,
.toc-toggle {
  will-change: transform;
  transform: translateZ(0);
}

/* 字體渲染優化 */
.page__content {
  font-variant-numeric: oldstyle-nums;
  font-feature-settings: "kern" 1, "liga" 1, "calt" 1;
  text-rendering: optimizeLegibility;
}

/* 容器查詢 (漸進增強) */
@container (min-width: 600px) {
  .archive__item {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: var(--space-md);
    align-items: start;
  }
  
  .archive__item-title {
    grid-column: 1;
  }
  
  .page__meta {
    grid-column: 2;
    grid-row: 1;
    text-align: right;
    white-space: nowrap;
  }
  
  .archive__item-excerpt {
    grid-column: 1 / -1;
  }
}

/* =============================================================================
   PART 23: JavaScript 整合類別 - 為互動做準備
   ============================================================================= */

/* 載入狀態 */
.is-loading {
  pointer-events: none;
  opacity: 0.6;
  cursor: wait;
}

/* 顯示/隱藏狀態 */
.is-hidden {
  display: none !important;
}

.is-visible {
  display: block !important;
}

/* TOC 活動狀態 */
.toc-item.is-active {
  font-weight: 600;
  color: var(--color-accent);
}

.toc-item.is-visible {
  opacity: 1;
}

.toc-item.is-hidden {
  opacity: 0.5;
}

/* 漸進顯示動畫 */
.js .reveal {
  opacity: 0;
  transform: translateY(20px);
  transition: opacity var(--duration-slow) ease, transform var(--duration-slow) ease;
}

.js .reveal.is-revealed {
  opacity: 1;
  transform: translateY(0);
}

/* 閱讀進度指示器 */
.reading-progress {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 3px;
  background: var(--color-bg-muted);
  z-index: 1100;
}

.reading-progress__bar {
  height: 100%;
  background: linear-gradient(90deg, var(--color-accent), var(--color-primary));
  width: 0%;
  transition: width var(--duration-fast) ease;
}

/* =============================================================================
   PART 24: 列印樣式 - 保持內容完整性
   ============================================================================= */

@media print {
  .theme-toggle,
  .toc-toggle,
  .toc,
  .masthead,
  .page__footer,
  .sidebar,
  .reading-progress {
    display: none !important;
  }
  
  body {
    font-size: 12pt;
    line-height: 1.4;
    color: #000;
    background: #fff;
  }
  
  .page__content {
    margin: 0;
    padding: 0;
    box-shadow: none;
    border-radius: 0;
    max-width: none;
  }
  
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
    page-break-inside: avoid;
  }
  
  blockquote,
  .highlight {
    page-break-inside: avoid;
  }
  
  a[href^="http"]:after {
    content: " (" attr(href) ")";
    font-size: 0.8em;
  }
}

/* =============================================================================
   PART 25: 實驗性功能 - 漸進增強
   ============================================================================= */

/* CSS 滾動捕捉 */
@supports (scroll-snap-type: y mandatory) {
  .article-list {
    scroll-snap-type: y proximity;
  }
  
  .archive__item {
    scroll-snap-align: start;
  }
}

/* 現代選取樣式 */
::selection {
  background: hsla(from var(--color-accent) h s l / 0.3);
  color: var(--color-text);
}

::-moz-selection {
  background: hsla(from var(--color-accent) h s l / 0.3);
  color: var(--color-text);
}

/* 深色模式圖片調整 */
[data-theme="dark"] img {
  opacity: 0.9;
  transition: opacity var(--duration-normal) ease;
}

[data-theme="dark"] img:hover {
  opacity: 1;
}

/* =============================================================================
   PART 26: 除錯工具 (生產環境請移除)
   ============================================================================= */

/* 解除註解以進行佈局除錯 */
/*
.debug * {
  outline: 1px solid red !important;
}

.debug .toc {
  outline: 2px solid blue !important;
}

.debug .sidebar {
  outline: 2px solid green !important;
}

.debug .page__content {
  outline: 2px solid purple !important;
}
*/

/* stylelint-enable */